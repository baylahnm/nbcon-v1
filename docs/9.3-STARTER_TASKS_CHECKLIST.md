# Starter Tasks â€” Production-Ready Checklist

## Priority 0 (Critical Security & Data Integrity)

### Security Vulnerabilities
- [ ] **Audit all authentication endpoints** for missing RBAC checks
  - Search: `export.*function.*auth|login|register` without `RequireRole`
  - Add: Server-side role validation before sensitive operations
  - Test: Attempt access with wrong role; verify 403 response
  - Risk: High - Security vulnerability

- [ ] **Sanitize all user-generated content** for XSS prevention
  - Search: `dangerouslySetInnerHTML` without DOMPurify
  - Add: DOMPurify or similar sanitization library
  - Test: Submit XSS payloads; verify they're neutralized
  - Risk: High - XSS vulnerability

- [ ] **Add SQL injection protection** to all database queries
  - Search: `${` in SQL query strings
  - Replace: Use parameterized queries or ORM methods
  - Test: Submit SQL injection payloads; verify they fail safely
  - Risk: Critical - Data breach risk

### Data Integrity
- [ ] **Add validation schemas** to all API endpoints
  - Search: API routes without zod/yup validation
  - Add: Schema validation at entry points
  - Test: Submit invalid data; verify proper error responses
  - Risk: Medium - Data corruption possible

- [ ] **Fix payment rounding errors** in currency calculations
  - Search: `toFixed(` in payment/invoice code
  - Replace: Use proper currency library (e.g., dinero.js)
  - Test: Calculate with edge cases (0.01, 999999.99)
  - Risk: High - Financial data integrity

## Priority 1 (High Impact)

### i18n & Formatting
- [ ] **Replace hard-coded 'en-US' formatters** with locale-aware versions
  - Search: `toLocaleDateString('en-US'` | `Intl.NumberFormat('en-US'`
  - Replace: Use `formatSAR`, `formatDate` from shared utils
  - Add: Get locale from `document.documentElement.lang`
  - Test: Verify formatting with 'ar' and 'en' locales
  - Test: Verify RTL/LTR date and number rendering
  - Risk: Medium - Incorrect display for Arabic users

- [ ] **Add locale-aware currency formatting** for invoices/payments
  - Search: `toFixed(` in currency formatting
  - Replace: `new Intl.NumberFormat(locale, { style: 'currency', currency: 'SAR' })`
  - Test: Format amounts in Arabic and English
  - Risk: Medium - User experience issue

### Navigation & SPA
- [ ] **Replace full page reloads** with SPA navigation
  - Search: `window.location.assign(` | `window.location.href =`
  - Replace: Use React Router `navigate()` or `<Link>`
  - Test: Verify no full page reload; state preserved
  - Risk: Low - Poor UX but not breaking

- [ ] **Add SPA-friendly error handling** for 401/403 responses
  - Search: Auth error handling
  - Add: Centralized interceptor for auth errors
  - Test: Simulate 401; verify redirect without reload
  - Risk: Medium - Auth flow breaks

### Error Handling
- [ ] **Implement global error boundary** in app shell
  - Location: `src/App.tsx` or root component
  - Add: React Error Boundary with user-friendly fallback
  - Add: Error reporting to monitoring service (Sentry, etc.)
  - Test: Throw error in component; verify fallback UI
  - Risk: Low - Improves error handling

- [ ] **Standardize API error responses** across all endpoints
  - Current: Inconsistent error formats
  - Target: `{ code: string, http: number, message: string, details?: any, traceId: string }`
  - Add: Error factory function + middleware
  - Test: All error types return standard format
  - Risk: Medium - Breaking change if not backward compatible

- [ ] **Add correlation IDs** to all API requests/responses
  - Add: Generate `requestId` in middleware
  - Add: Include in all logs and error responses
  - Add: Propagate through async operations
  - Test: Verify requestId in logs and errors
  - Risk: Low - Pure observability enhancement

### RBAC & Authorization
- [ ] **Centralize RBAC checks** in reusable guards
  - Search: Inline role checks scattered in code
  - Create: `RequireRole`, `hasPermission` utilities
  - Replace: All inline checks with centralized functions
  - Test: All role + subscription combinations
  - Risk: High - Auth bypass if wrong

- [ ] **Add server-side RBAC validation** for all protected endpoints
  - Search: Client-only role checks
  - Add: Middleware to validate role on server
  - Test: Bypass client check; verify server blocks
  - Risk: Critical - Security vulnerability

## Priority 2 (Medium Impact)

### Performance
- [ ] **Eliminate N+1 queries** in critical paths
  - Search: Loops with database calls inside
  - Replace: Batch queries or use ORM includes
  - Test: Monitor query count before/after
  - Metric: Reduce queries by >80%
  - Risk: Low - Pure performance win

- [ ] **Add database indexes** for slow queries
  - Search: Slow query logs
  - Analyze: Queries without indexes on WHERE/JOIN columns
  - Add: Migrations to create indexes
  - Test: Verify query performance improvement
  - Risk: Low - Only affects performance

- [ ] **Add timeouts to external API calls**
  - Search: `fetch(` | `axios(` without timeout
  - Add: Timeout configuration (e.g., 30s)
  - Add: Retry with exponential backoff
  - Test: Simulate slow endpoint; verify timeout
  - Risk: Medium - Prevents hanging requests

- [ ] **Implement request cancellation** for user navigation
  - Search: `useEffect` with API calls
  - Add: AbortController for in-flight requests
  - Test: Navigate away during API call; verify cancellation
  - Risk: Low - Prevents memory leaks

### Observability
- [ ] **Add structured logging** to all background services
  - Format: JSON with `{ timestamp, level, message, requestId, userId, role, ...context }`
  - Remove: Console.log statements
  - Test: Verify logs are parseable JSON
  - Test: Verify no PII in logs
  - Risk: Low - Pure observability enhancement

- [ ] **Add metrics** for business-critical operations
  - Auth: `auth_success_rate`, `auth_failure_by_reason`
  - Payments: `payment_success_rate`, `payment_processing_time`
  - Jobs: `job_match_rate`, `job_completion_time`
  - Add: Custom metrics in application code
  - Test: Trigger events; verify metrics increment
  - Risk: Low - Pure observability enhancement

- [ ] **Configure alerts** for elevated error rates
  - Add: Alert for error rate >5% over 5min
  - Add: Alert for p95 response time >30s
  - Add: Alert for payment failures >10/min
  - Add: PagerDuty/Slack integration
  - Test: Trigger thresholds; verify alerts fire
  - Risk: Low - Pure observability enhancement

- [ ] **Add distributed tracing** with trace IDs
  - Add: Generate traceId at entry point
  - Add: Propagate through all async operations
  - Add: Include in all logs and errors
  - Test: Follow trace through multiple services
  - Risk: Low - Pure observability enhancement

### State Management (Zustand)
- [ ] **Audit Zustand stores** for direct mutations
  - Search: `state.` assignments outside `set()`
  - Replace: All mutations use `set()` or `update()`
  - Test: State updates trigger re-renders
  - Risk: Medium - State bugs if not fixed

- [ ] **Add migration strategy** for persisted stores
  - Search: `persist()` without `version` field
  - Add: Version field and migration functions
  - Test: Change schema; verify migration runs
  - Risk: High - Data loss if not handled

### Testing
- [ ] **Add integration tests** for critical flows
  - Auth: Login, logout, role transitions
  - Payments: Payment creation, status updates, webhooks
  - Jobs: Job creation, engineer matching, completion
  - Test: End-to-end happy paths and error cases
  - Risk: Low - Pure quality improvement

- [ ] **Add edge case tests** for all bug fixes
  - Test: null, undefined, empty arrays/objects
  - Test: Boundary conditions (min/max values)
  - Test: Concurrent operations (race conditions)
  - Test: Network failures, timeouts
  - Risk: Low - Prevents regressions

### Configuration
- [ ] **Add environment variable validation** at startup
  - Add: Schema for required env vars
  - Add: Validation on app startup
  - Test: Missing var causes startup failure with clear error
  - Risk: Low - Prevents misconfiguration

- [ ] **Remove secrets from source code**
  - Search: API keys, passwords, tokens in code
  - Replace: Environment variables
  - Add: Instructions in README for local setup
  - Risk: Critical - Security vulnerability

## CI/CD Health
- [ ] **Fix all linter errors**
  - Run: `npm run lint --fix`
  - Fix: Remaining manual issues
  - Test: CI lint check passes
  - Risk: Low - Code quality

- [ ] **Fix all TypeScript errors**
  - Run: `npm run type-check`
  - Fix: All type errors (no `any` escape hatches)
  - Test: CI type check passes
  - Risk: Low - Type safety

- [ ] **Ensure all tests pass**
  - Run: `npm test`
  - Fix: Flaky or failing tests
  - Test: CI test suite passes
  - Risk: Low - Quality gate

- [ ] **Update CHANGELOG** for each fix
  - Format: `## [Unreleased]\n### Fixed\n- Fix description (#issue)`
  - Include: Risk level, migration notes
  - Test: CHANGELOG is up to date
  - Risk: Low - Documentation
