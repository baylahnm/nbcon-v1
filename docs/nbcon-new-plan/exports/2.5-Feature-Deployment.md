# Export: 2.5 — Phase C: Database & RLS Cleanup (Section 5)

Source: ../2%205-%F0%9F%97%84%EF%B8%8FPhase%20C%20Database%20&%20RLS%20Cleanup%20(Section%205)%2029d608c2eef780b385e3edd6cad6b076.md

Summary (key points):
- Objectives: remove legacy roles, standardize RLS (`is_admin` + `auth.uid()`), verify policy coverage, add audit trail, snapshot + rollback
- Deliverables: drop_role.sql, update_rls_is_admin.sql, policy_audit_report.md, seed updates, rollback script, tag v2.0.2-db
- Implementation Steps: drop `profiles.role`; rewrite policies USING (auth.uid() = owner_id OR is_admin); audit unprotected tables; link subscriptions FK; add audit triggers; regen types; tag DB
- SQL Examples: DROP COLUMN role; policies for SELECT/INSERT with is_admin; audit_log table + trigger for tier changes
- Architecture: profiles (subscription_tier, is_admin), projects, subscriptions, audit_log with unified RLS
- Coverage Matrix: policies active across profiles/projects/subscriptions/messages/audit_log
- Validation: grep for role refs; list policies; schema diff; regenerate types
- Checklist: drop role, rebuild RLS, audit coverage, implement audit log, seed tiers, validate Stripe sync, regen types, tag release
- Risks: residual role refs, admin lockout, schema drift, audit log bloat — mitigations via CI checks, manual overrides, migration tags, cleanup jobs

Navigation:
- For full details, open the source link above.
- See ../../README.md for the ordered section list.
