# Export: 2.14 — Stripe & Subscription Management System (Section 14)

Source: ../2%2014%20-%20%F0%9F%92%B5%20Stripe%20&%20Subscription%20Management%20(%2029d608c2eef780b491ebd666c5e143cf.md

Summary (key points):
- Objective: integrate Stripe for seamless billing, subscription management, automated tier enforcement (Free/Basic/Pro/Enterprise); sync entitlements with Supabase and FeatureGate
- Integration Goals: subscription sync (Stripe products ↔ NBCON tiers), automated billing (recurring/invoices/renewals), real-time entitlements, feature gating, audit/compliance
- Architecture Flow: User → Billing Portal/Checkout → Stripe API → Webhook (Edge Function) → Supabase (profiles/subscription_events) → FeatureGate → App Modules
- Stripe Objects Mapping: Product → Plan, Price → subscription price, Customer → profiles.id, Subscription → billing record, Invoice → financial record, Webhook Event → subscription_events table
- Environment Variables: STRIPE_PUBLIC_KEY, STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET, NEXT_PUBLIC_STRIPE_PRICE_* (Basic/Pro/Enterprise)
- Edge Functions: checkout.ts (session creation), stripe-webhook.ts (event handling), update-tier.ts (tier sync), get-billing-portal.ts (portal redirect)
- Entitlement Flow: Stripe event → Webhook → profiles.subscription_tier → FeatureGate → unlocks features → Audit Log
- Finance Dashboard: active subscriptions, MRR (SAR), churn rate, failed payments, revenue by region, invoice history
- Testing: checkout flow (Playwright), upgrade/downgrade sync (unit tests), webhook security (HMAC validation), FeatureGate access (E2E), cancellation flow (manual QA)
- Deliverables: Stripe account setup, env vars, Edge functions, webhook handler, FeatureGate integration, QA testing, finance dashboard, risk register, runbook appendix

Navigation:
- For full details, open the source link above.
- See ../../README.md for the ordered section list.

