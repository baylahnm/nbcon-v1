# Export: 2.4 — Phase B: Access & Data Model (Section 4)

Source: ../2%204-%20%F0%9F%94%90%20Phase%20B%20Access%20&%20Data%20Model%20(Section%204)%2029d608c2eef780fd9a40ca180e4a7a6b.md

Summary (key points):
- Context: deprecate legacy roles; move to plan-driven access via `subscription_tier` + `is_admin`
- Deliverables: profiles schema migration, RLS rewrite (is_admin), usePortalAccess hook, tierMeetsRequirement util, Stripe→Supabase sync
- Implementation Steps: add migration for `subscription_tier`/`is_admin`; map legacy roles to tiers; replace role checks; update FeatureGate; add Stripe price mapping; regenerate Supabase types
- New Data Model: profiles with `subscription_tier` enum and `is_admin` boolean
- Flow: Stripe Webhook → update profiles.subscription_tier → frontend hook refresh → FeatureGate enforces tier
- Example Policy: USING (auth.uid() = id OR is_admin)
- Acceptance Tests: role column removed; is_admin policy; FeatureGate for free; webhook sync; hook values match DB
- Risks: missed role refs, wrong Stripe sync, RLS lockout, stale types — mitigated by CI scans and idempotent webhooks

Navigation:
- For full details, open the source link above.
- See ../../README.md for the ordered section list.
