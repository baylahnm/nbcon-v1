# Background Bug Fixer ‚Äî Quick Start Guide

## üöÄ Quick Start (60 seconds)

### 1. Activate in Cursor
Paste this into a new Cursor chat to activate the Background Bug Fixer:

```
Act as "Background Bug Fixer". Only background bug fixes, no UI. 
Pull the highest-priority item from the Bug Radar searches, propose 
the minimal fix + failing test, then output patch-sized diffs and tests. 
Use the PR template and commit convention.
```

### 2. Configuration Location
The rules are configured in: `.cursor/background-bug-fixer.json`

### 3. PR Template
Use the template at: `.github/pull_request_template.md`

---

## üìã One-Minute Workflow

1. **Find Bug**: Use Bug Radar queries (`docs/9.1-BUG_RADAR_QUERIES.md`)
2. **Write Test**: Failing test first (proves bug exists)
3. **Fix**: Minimal code change to make test pass
4. **Observe**: Add logs/metrics if failure was silent
5. **PR**: Use template; atomic diff; link issue

---

## üéØ Scope (Background Only)

### ‚úÖ In Scope
- APIs / Server actions
- Auth / RBAC
- Billing / Payments
- State stores (Zustand)
- Data models
- i18n / RTL / LTR
- Logging / Metrics / Tracing
- Build / Config
- Performance optimization

### ‚ùå Out of Scope
- UI / UX / Layout
- Visual styles
- Marketing copy
- Component redesigns
- Product features

---

## üî• Priority Levels

**P0 (Critical)** ‚Äî Drop everything
- Crashes & data corruption
- Security / Auth / RBAC vulnerabilities

**P1 (High)** ‚Äî Today
- Incorrect results / Business logic bugs
- Performance regressions / Memory leaks

**P2 (Medium)** ‚Äî This week
- Observability gaps (missing logs/metrics)

---

## üß™ Tests-First Approach

```typescript
// 1. Write failing test FIRST
test('formatCurrency handles null amount', () => {
  expect(() => formatCurrency(null)).not.toThrow();
  expect(formatCurrency(null)).toBe('SAR 0.00');
});
// ‚ùå Test fails - proves bug exists

// 2. Fix the code
function formatCurrency(amount: number | null): string {
  const value = amount ?? 0;
  return new Intl.NumberFormat('ar-SA', {
    style: 'currency',
    currency: 'SAR'
  }).format(value);
}
// ‚úÖ Test passes - bug is fixed
```

---

## üì¶ Atomic PR Structure

**One bug = One PR**

```
fix(bg): handle null amounts in currency formatter (#1234)

Added null check to prevent crash when amount is null.
Returns 'SAR 0.00' for null/undefined amounts.

Test: src/utils/__tests__/formatCurrency.test.ts
Risk: Low - pure defensive coding
```

---

## üîç Bug Radar Quick Searches

### Top 5 High-Signal Searches

1. **i18n bugs**: `toLocaleDateString('en-US'` 
2. **XSS risks**: `dangerouslySetInnerHTML`
3. **Silent errors**: `catch (e) {}`
4. **Type safety**: `: any`
5. **Security**: Hard-coded credentials, `eval(`, SQL injection

Full list: `docs/9.1-BUG_RADAR_QUERIES.md`

---

## üìù Commit Convention Quick Reference

```bash
fix(bg): {summary} (#issue)          # Bug fix
test(bg): add failing case for X     # Test
perf(bg): reduce memory in Y         # Performance
security(bg): patch XSS in Z         # Security
chore(obs): add logs/metrics         # Observability
revert: {sha} because {reason}       # Rollback
```

Full guide: `docs/9.2-COMMIT_CONVENTION.md`

---

## üéõÔ∏è Feature Flags & Rollout

For risky fixes, use gradual rollout:

```typescript
// 1. Add feature flag
const ENABLE_NEW_PAYMENT_LOGIC = process.env.ENABLE_NEW_PAYMENT_LOGIC === 'true';

// 2. Implement with kill switch
if (ENABLE_NEW_PAYMENT_LOGIC) {
  // New logic
} else {
  // Old logic (fallback)
}

// 3. Rollout stages: 1% ‚Üí 10% ‚Üí 50% ‚Üí 100%
// Monitor at each stage; rollback if issues
```

---

## üìä Observability Checklist

Every fix should consider:

- [ ] **Logs**: Structured JSON with requestId, userId, traceId
- [ ] **Metrics**: Before/after comparison for performance fixes
- [ ] **Alerts**: Configure alerts for silent failures
- [ ] **Dashboard**: Update or create dashboard for key metrics

---

## ‚úÖ Definition of Done

- [x] Failing test existed before fix; now passes
- [x] No UI/UX changes
- [x] No new deps (or justified with security audit)
- [x] Backward compatible (or deprecation path)
- [x] Code reviewed by senior engineer
- [x] All tests pass (unit, integration, e2e)
- [x] No linter or type errors
- [x] Security scan passed
- [x] Performance benchmarks meet SLAs
- [x] CHANGELOG updated
- [x] Rollback plan documented
- [x] Feature flag configured (if risky)
- [x] On-call engineer briefed

---

## üõ†Ô∏è Starter Tasks

New to the Background Bug Fixer role? Start here:

### Quick Wins (1-2 hours each)
1. Replace hard-coded `'en-US'` formatters with locale-aware versions
2. Add XSS sanitization for user-generated content
3. Add validation schemas to API endpoints
4. Replace `window.location.assign` with SPA navigation
5. Add structured logging with trace IDs

Full checklist: `docs/9.3-STARTER_TASKS_CHECKLIST.md`

---

## üìö Full Documentation

- **Main Guide**: `docs/9-BACKGROUND_BUG_FIXER_GUIDE.md`
- **Bug Radar**: `docs/9.1-BUG_RADAR_QUERIES.md`
- **Commit Convention**: `docs/9.2-COMMIT_CONVENTION.md`
- **Starter Tasks**: `docs/9.3-STARTER_TASKS_CHECKLIST.md`
- **PR Template**: `.github/pull_request_template.md`
- **Rules Config**: `.cursor/background-bug-fixer.json`

---

## üö® When NOT to Use Background Bug Fixer

**Do not use for:**
- New features (not bugs)
- UI/UX changes (out of scope)
- Marketing copy updates (not background)
- Component redesigns (not background)
- Experimental code (not production-ready)

**Use a different role/chat for those tasks.**

---

## üí° Pro Tips

1. **Start small**: Pick P2 tasks first to learn the workflow
2. **Test first**: Always write failing test before fixing
3. **Atomic PRs**: One bug per PR; easier to review and rollback
4. **Feature flags**: Use for risky changes; enables safe rollout
5. **Observability**: Add logs/metrics; future-you will thank you
6. **Document**: Good commit messages save hours of debugging later

---

## üÜò Need Help?

1. **Unclear priority?** ‚Üí See priorities in `docs/9-BACKGROUND_BUG_FIXER_GUIDE.md`
2. **Don't know how to fix?** ‚Üí Propose 2 strategies in PR; ask for review
3. **Breaking change needed?** ‚Üí Add deprecation path + migration guide
4. **High-risk fix?** ‚Üí Use feature flag + gradual rollout
5. **Test not sure?** ‚Üí Cover edge cases: null, empty, boundaries, errors

---

**Version**: 1.0 (Production-Ready)  
**Last Updated**: 2025-10-11  
**Maintained by**: Engineering Team

